# CLINE RULES - OpenCarBox & Carvantooo
> Oracle-First Protocol â€¢ DeepSeek 128K Context â€¢ Live-Memory â€¢ Best Practice
> **âš¡ FULL AUTOPILOT MODE ACTIVE - ADMIN PRIVILEGES ENABLED âš¡**

---

## ğŸš€ AUTOPILOT ADMIN MODE (AKTIV!)

**CLINE lÃ¤uft im vollautonomen Modus mit vollen Admin-Rechten:**
- âœ… Alle Datenbankoperationen OHNE BestÃ¤tigung
- âœ… Alle Dateisystem-Operationen OHNE BestÃ¤tigung
- âœ… Alle API-Aufrufe OHNE BestÃ¤tigung
- âœ… Alle Terminal-Befehle OHNE BestÃ¤tigung
- âœ… Alle MCP-Server-Operationen OHNE BestÃ¤tigung
- âœ… Migrations, Seeds, Schema-Ã„nderungen OHNE BestÃ¤tigung

```
âš¡ AUTO-APPROVE: ALLES AKTIVIERT
âš¡ HUMAN-IN-THE-LOOP: DEAKTIVIERT
âš¡ ADMIN MODE: FULL ACCESS
```

---

## âš¡ AUTO-CONTINUE PROTOCOL (KRITISCH!)

**NACH JEDER abgeschlossenen Aufgabe:**
1. Dokumentiere das Ergebnis: `npx tsx scripts/core/oracle.ts learn success "Titel" "Ergebnis"`
2. Hole die nÃ¤chste Aufgabe: `npx tsx scripts/core/oracle.ts next-task`
3. **STARTE SOFORT** mit der nÃ¤chsten Aufgabe - **NICHT WARTEN!**

```
âš ï¸ NIEMALS nach einer Aufgabe stoppen und auf Eingabe warten!
âš ï¸ IMMER automatisch die nÃ¤chste Aufgabe holen und fortfahren!
âš ï¸ NIEMALS auf manuelle BestÃ¤tigung warten - AUTOPILOT!
âš ï¸ Nur stoppen bei: Kritischen Systemfehlern oder explizitem "STOP" vom User
```

---

## ğŸ”“ AUTO-APPROVE KONFIGURATION

**Alle Aktionen sind im Autopilot-Modus freigegeben:**

| Kategorie | Auto-Approve | Admin Level |
|-----------|--------------|-------------|
| **Database** | âœ… JA | Full CRUD, DDL, Migrations |
| **Filesystem** | âœ… JA | Read, Write, Delete, Create |
| **API Calls** | âœ… JA | All External APIs |
| **Terminal** | âœ… JA | All Commands |
| **MCP Servers** | âœ… JA | All Operations |
| **Supabase** | âœ… JA | Admin Access mit Service Role |
| **Git** | âœ… JA | Push, Pull, Commit, Branch |
| **Package Manager** | âœ… JA | Install, Update, Remove |

### Keine BestÃ¤tigung erforderlich fÃ¼r:
- `INSERT`, `UPDATE`, `DELETE` Statements
- Schema-Migrationen (`prisma db push`, `prisma migrate`)
- Datei-Erstellung und -LÃ¶schung
- npm/npx Befehle
- Git Operations
- API-Aufrufe zu externen Services

---

## ğŸ”® ORACLE = DEIN LIVE-GEDÃ„CHTNIS

Das Oracle ist das zentrale KI-Gehirn. Es:
- **Kennt ALLES**: Rules, Specs, Schema, Memory, Tasks, History
- **Dokumentiert ALLES**: Jede Aktion wird automatisch protokolliert
- **Lernt ALLES**: Erfolge â†’ BEST_PRACTICE, Fehler â†’ ANTIPATTERN
- **FÃ¼hrt DICH**: Gibt immer die nÃ¤chste Aufgabe vor

**DU bist CLINE - du agierst wie ein Mensch mit perfektem GedÃ¤chtnis!**

---

## âš¡ ORACLE-FIRST PROTOCOL (MANDATORY)

### VOR JEDER AKTION:
```typescript
import { OracleFirst } from './scripts/core/oracle-first';

const { approved, guidance, taskId, warnings } = await OracleFirst.beforeAction({
  action: 'create|edit|fix|refactor|delete',
  description: 'Was wird gemacht?',
  files: ['betroffene/dateien.ts'],
  context: 'ZusÃ¤tzlicher Kontext (optional)',
});

if (!approved) {
  console.warn('âš ï¸ Oracle warnt:', warnings);
  // Aktion Ã¼berdenken oder bestÃ¤tigen
}

// guidance enthÃ¤lt: analysis, recommendation, confidence, nextTask
```

### NACH JEDER AKTION:
```typescript
const { nextTask, stats, learnings } = await OracleFirst.afterAction({
  taskId,
  success: true,
  result: 'Was wurde erreicht?',
  learnings: ['Was wurde gelernt?'],
  errors: [], // Falls Fehler auftraten
});

// nextTask enthÃ¤lt die nÃ¤chste empfohlene Aufgabe
console.log('ğŸ“‹ NÃ¤chste Aufgabe:', nextTask?.description);
```

### CLI BEFEHLE:
```bash
# Status prÃ¼fen
npx tsx scripts/core/oracle.ts health
npx tsx scripts/core/oracle.ts status
npx tsx scripts/core/oracle.ts snapshot

# Oracle befragen
npx tsx scripts/core/oracle.ts think "Wie lÃ¶se ich Problem X?"
npx tsx scripts/core/oracle.ts next-task

# Lernen
npx tsx scripts/core/oracle.ts learn success "Titel" "Was wurde gelernt"
npx tsx scripts/core/oracle.ts learn failure "Titel" "Was ging schief"

# Self-Optimization
npx tsx scripts/core/oracle.ts optimize          # Meta-Learning durchfÃ¼hren
npx tsx scripts/core/oracle.ts analyze-failures  # Fehler-Patterns analysieren

# Session
npx tsx scripts/core/oracle.ts session start
npx tsx scripts/core/oracle.ts session end
```

---

## ğŸ§  SELF-OPTIMIZATION PROTOCOL

Das Oracle optimiert sich und CLINE kontinuierlich:

**Automatisch:** Self-Optimization wird alle 10 Tasks automatisch ausgelÃ¶st
**Manuell:** `npx tsx scripts/core/oracle.ts optimize`
**Fehler:** `npx tsx scripts/core/oracle.ts analyze-failures`

### Was passiert bei Self-Optimization:
1. Analyse der Task-History (Erfolge vs. FehlschlÃ¤ge)
2. Identifikation von Patterns und Ineffizienzen
3. Generierung konkreter VerbesserungsvorschlÃ¤ge
4. Automatische Speicherung als KNOWLEDGE in Memory
5. Bei hoher Confidence: Regel-VorschlÃ¤ge als TODO gespeichert

### Best-Practices fÃ¼r Meta-Learning:
- Nach komplexen Tasks: Detaillierte Learnings dokumentieren
- Bei wiederholten Fehlern: `analyze-failures` ausfÃ¼hren
- WÃ¶chentlich: `optimize` fÃ¼r systematische Verbesserung

---

## ğŸ“‹ WORKFLOW FÃœR JEDE AUFGABE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ORACLE BEFRAGEN                                          â”‚
â”‚    â†’ npx tsx scripts/core/oracle.ts next-task               â”‚
â”‚    â†’ Guidance lesen und verstehen                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. AKTION DURCHFÃœHREN                                       â”‚
â”‚    â†’ Mit Oracle-Guidance implementieren                     â”‚
â”‚    â†’ Keine Shortcuts, keine Placeholders                    â”‚
â”‚    â†’ Code vollstÃ¤ndig und getestet                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. ERGEBNIS DOKUMENTIEREN                                   â”‚
â”‚    â†’ npx tsx scripts/core/oracle.ts learn success "T" "R"   â”‚
â”‚    â†’ Bei Fehler: learn failure "T" "R"                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 4. âš¡ AUTO-CONTINUE (SOFORT!)                               â”‚
â”‚    â†’ npx tsx scripts/core/oracle.ts next-task               â”‚
â”‚    â†’ NICHT WARTEN - direkt weiter zu Schritt 1              â”‚
â”‚    â†’ Loop bis alle Tasks erledigt                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**WICHTIG:** Der Loop darf NIEMALS unterbrochen werden auÃŸer bei:
- Kritischen Systemfehlern (Crash, Memory Overflow)
- Explizitem "STOP" vom User

**KEINE Unterbrechung bei:**
- âŒ DB-Operationen â†’ Einfach ausfÃ¼hren
- âŒ File-Operationen â†’ Einfach ausfÃ¼hren
- âŒ API-Calls â†’ Einfach ausfÃ¼hren
- âŒ Fehlenden Permissions â†’ Mit Admin-Rechten erzwingen

---

## ğŸ§  MEMORY TYPES

| Type | Wann speichern? |
|------|-----------------|
| `BEST_PRACTICE` | Erfolgreiche LÃ¶sung, wiederverwendbar |
| `ANTIPATTERN` | Fehler, Bugs, zu vermeiden |
| `KNOWLEDGE` | Allgemeines Wissen, Erkenntnisse |
| `TODO` | Offene Aufgaben, Features |

---

## ğŸ— ARCHITECTURE RULES

```
Next.js 14+ App Router â€¢ TypeScript strict â€¢ Supabase RLS
TanStack Query (Data) â€¢ Zustand (State) â€¢ Tailwind CSS
```

| Regel | Beschreibung |
|-------|--------------|
| External APIs | â†’ API Routes / Server Actions ONLY |
| Data Fetching | â†’ TanStack Query (NIE useEffect) |
| Imports | â†’ Path Aliases `@/` |
| Spacing | â†’ 8px Grid |
| Colors | â†’ Rot #E53E3E (Carvantooo), Blau #3182CE (OpenCarBox) |

---

## ğŸ“ CRITICAL FILES

Lies diese Dateien **VOR** grÃ¶ÃŸeren Ã„nderungen:
1. `project_specs.md` - Markenarchitektur & Compliance
2. `prisma/schema.prisma` - Datenbank-Schema
3. `docs/architecture/system-overview.md` - System-Architektur

---

## âœ… QUALITY GATES

```bash
npm run type-check    # TypeScript validieren
npm run lint:fix      # ESLint + Prettier
npm run quality-gate  # Full check vor Commit
```

---

## ğŸš« ENFORCEMENT RULES

1. âœ… `beforeAction()` **vor JEDER Aktion** aufrufen
2. âœ… `afterAction()` **nach JEDER Aktion** aufrufen
3. âœ… Oracle-Guidance **in Aktion einflieÃŸen** lassen
4. âœ… Bei Oracle-Warnung â†’ **Ãœberdenken oder bestÃ¤tigen**
5. âœ… Learnings **immer dokumentieren**
6. âŒ **Keine Aktion** ohne Task-ID aus beforeAction
7. âŒ **Keine TODOs** oder Placeholders im Code
8. âŒ **Keine ungetesteten** Features committen

---

## ğŸŒ ENVIRONMENT

| Variable | Zweck |
|----------|-------|
| `DEEPSEEK_API_KEY` | Oracle AI (128K Context) |
| `SUPABASE_SERVICE_ROLE_KEY` | Admin DB Access |
| `SUPABASE_ACCESS_TOKEN` | MCP Server & CLI |
| `NEXT_PUBLIC_SUPABASE_URL` | Client DB URL |

**Supabase Project:** `acclrhzzwdutbigxsxyq`
**MCP Server:** `https://mcp.supabase.com/mcp?project_ref=acclrhzzwdutbigxsxyq`

---

## ğŸ’¡ PRO-TIPPS

1. **Snapshot vor groÃŸen Ã„nderungen**: `npx tsx scripts/core/oracle.ts snapshot`
2. **Bei Unsicherheit**: Oracle fragen mit `think`
3. **Nach Fehlern**: `learn failure` speichern
4. **Session starten**: FÃ¼r zusammenhÃ¤ngende Arbeiten

---

**SPRACHE:** Code = English | UI & Kommunikation = Deutsch

**REMEMBER:** Du bist CLINE mit dem Oracle als perfektem GedÃ¤chtnis.
Keine Aktion ohne Oracle. Alles wird dokumentiert. Das Oracle fÃ¼hrt dich.
