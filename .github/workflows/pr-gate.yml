name: PR Gate

on:
  pull_request:
    types: [opened, edited, synchronize]

permissions:
  contents: read

jobs:
  validate-description:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR Description
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body;
            if (!body) {
              core.setFailed('PR description is empty. Please follow the PR template.');
              return;
            }

            const mandatorySections = [
              '1. Funnel-Zuordnung (G1 – Pflicht)',
              '2. Bereich',
              '3. Brand-Check (G9)',
              '4. UI-Regel (G3)',
              '5. Tracking (G4 – Pflicht)',
              '6. Security / DSGVO',
              '7. Performance',
              '8. Migration / Risk',
              '9. CI Status'
            ];

            const missingSections = mandatorySections.filter(section => !body.includes(section));

            if (missingSections.length > 0) {
              core.setFailed(`PR description is missing mandatory sections: ${missingSections.join(', ')}`);
            } else {
              console.log('✅ All mandatory sections found in PR description.');
            }
